[toc]

# 支付系统表设计

![image-20240511135659562](https://p.ipic.vip/ga1hw2.png)

# 资金账户表

资金账户表是金融系统中用于记录和管理资金账户信息的数据库表。这些表通常包含账户的基本信息、余额、交易记录等关键数据。以下是一个简化的资金账户表结构示例：

1. 1.**账户信息表（AccountInfo）**： **accountId**：账户ID，唯一标识每个账户。 **accountName**：账户名称。 **accountType**：账户类型，如个人账户、企业账户等。 **currency**：账户货币类型。 **balance**：账户当前余额。 **availableBalance**：可用余额。 **status**：账户状态，如激活、冻结等。 **createTime**：账户创建时间。 **updateTime**：账户信息最后更新时间。

2. 2.**账户交易记录表（AccountTransaction）**： **transactionId**：交易ID，唯一标识每笔交易。 **accountId**：关联的账户ID。 **transactionType**：交易类型，如存款、取款、转账等。 **transactionAmount**：交易金额。 **transactionDate**：交易日期和时间。 **transactionStatus**：交易状态，如成功、失败、待处理等。 **description**：交易描述或备注。

3. 3.**账户余额变动表（AccountBalanceChange）**： **changeId**：变动ID，唯一标识每笔余额变动。 **accountId**：关联的账户ID。 **changeAmount**：变动金额。 **changeType**：变动类型，如增加、减少等。 **changeDate**：变动日期和时间。 **reason**：变动原因，如支付、收款、利息等。

4. 4.**账户冻结/解冻记录表（AccountFreeze）**： **freezeId**：冻结ID，唯一标识每笔冻结记录。 **accountId**：关联的账户ID。 **freezeAmount**：冻结金额。 **freezeDate**：冻结日期和时间。 **unfreezeDate**：解冻日期和时间（如果已解冻）。 **reason**：冻结原因。

# 账务清算系统表

账务清算系统通常需要处理大量的财务数据，包括交易记录、账户信息、清算记录等。在设计账务清算系统的数据库表时，需要考虑数据的完整性和一致性，以及系统的性能和可扩展性。以下是一些可能包含在账务清算系统中的核心数据库表及其字段：

1. **交易记录表（Transaction）**： 交易ID（TransactionID）：唯一标识每笔交易。 交易日期（TransactionDate）：交易发生的时间。 交易金额（Amount）：交易涉及的金额。 交易类型（TransactionType）：交易的类型，如存款、取款、转账等。 交易账户（AccountID）：涉及的账户ID。 交易描述（Description）：交易的详细描述。

2. **账户信息表（Account）**： 账户ID（AccountID）：唯一标识每个账户。 账户类型（AccountType）：账户的类型，如个人账户、企业账户等。 账户余额（Balance）：账户当前的余额。 开户银行（Bank）：账户所属的银行。 账户持有人（Holder）：账户持有人的姓名或其他标识信息。

3. **清算记录表（ClearingRecord）**： 清算ID（ClearingID）：唯一标识每笔清算记录。 清算日期（ClearingDate）：清算发生的时间。 清算金额（ClearingAmount）：清算涉及的金额。 清算状态（ClearingStatus）：清算的状态，如待清算、已清算、清算失败等。 清算参考（Reference）：与清算相关的交易记录或其他参考信息。

4. **对账记录表（ReconciliationRecord）**： 

   对账ID（ReconciliationID）：唯一标识每笔对账记录。 

   对账日期（ReconciliationDate）：对账发生的时间。 

   对账结果（ReconciliationResult）：对账的结果，如一致、不一致等。 

   对账差异（Discrepancy）：对账中发现的差异金额或记录。

   ### 对账记录表（ReconciliationRecord）

   | 字段名             | 数据类型      | 描述                                 | 索引 | 备注 |
   | ------------------ | ------------- | ------------------------------------ | ---- | ---- |
   | recordId           | INT           | 对账记录的唯一标识符。自增主键。     | PK   |      |
   | accountId          | INT           | 账户ID，关联到账户信息表。           |      |      |
   | reconciliationDate | DATE          | 对账日期。                           |      |      |
   | transactionType    | VARCHAR(255)  | 交易类型，如支付、退款、转账等。     |      |      |
   | transactionId      | VARCHAR(255)  | 交易ID，关联到交易记录表。           |      |      |
   | amount             | DECIMAL(10,2) | 交易金额。                           |      |      |
   | status             | VARCHAR(50)   | 对账状态，如匹配、不匹配、待处理等。 |      |      |
   | matchStatus        | VARCHAR(50)   | 匹配状态，如已匹配、未匹配等。       |      |      |
   | notes              | TEXT          | 对账备注或说明。                     |      |      |
   | createdAt          | TIMESTAMP     | 对账记录创建时间。                   |      |      |
   | updatedAt          | TIMESTAMP     | 对账记录最后更新时间。               |      |      |

   | recordId | accountId | reconciliationDate | transactionType | transactionId | amount | status | matchStatus | notes | createdAt           | updatedAt           |
   | -------- | --------- | ------------------ | --------------- | ------------- | ------ | ------ | ----------- | ----- | ------------------- | ------------------- |
   | 1        | 123456    | 2023-05-13         | 支付            | 987654        | 100.00 | 匹配   | 已匹配      | 无    | 2023-05-13 10:00:00 | 2023-05-13 10:00:00 |

5. **用户表（User）**： 用户ID（UserID）：唯一标识每个用户。 用户名（Username）：用户的登录名。 密码（Password）：用户的登录密码。 角色（Role）：用户的权限角色，如管理员、操作员等。 联系信息（ContactInfo）：用户的联系信息，如电话、邮箱等。

6. **日志记录表（Log）**： 日志ID（LogID）：唯一标识每条日志记录。 操作时间（OperationTime）：操作发生的时间。 操作用户（Operator）：执行操作的用户ID。 操作内容（Operation）：操作的具体内容。 操作结果（Result）：操作的结果，如成功、失败等。

7. **对账差异表（Reconciliation Difference Table）**： 存储对账过程中发现的差异信息，包括差异ID、交易ID、差异金额、差异原因等。

8. **对账日志表（Reconciliation Log Table）**： 存储对账操作的日志信息，包括操作时间、操作人、操作内容等。

9. **对账结果表（Reconciliation Result Table）**： 存储对账结果的汇总信息，包括对账周期、对账总金额、对账总笔数、对账成功笔数、对账失败笔数等。

   ### 对账结果表（ReconciliationResult）

   | 字段名                 | 数据类型      | 描述                             | 索引 | 备注 |
   | ---------------------- | ------------- | -------------------------------- | ---- | ---- |
   | resultId               | INT           | 对账结果的唯一标识符。自增主键。 | PK   |      |
   | reconciliationDate     | DATE          | 对账周期的开始日期。             |      |      |
   | totalAmount            | DECIMAL(10,2) | 对账周期内的总交易金额。         |      |      |
   | totalTransactions      | INT           | 对账周期内的总交易笔数。         |      |      |
   | successfulTransactions | INT           | 对账周期内成功对账的交易笔数。   |      |      |
   | failedTransactions     | INT           | 对账周期内失败对账的交易笔数。   |      |      |
   | notes                  | TEXT          | 对账结果的备注或说明。           |      |      |
   | createdAt              | TIMESTAMP     | 对账结果记录创建时间。           |      |      |
   | updatedAt              | TIMESTAMP     | 对账结果最后更新时间。           |      |      |

   ### 示例数据

   | resultId | reconciliationDate | totalAmount | totalTransactions | successfulTransactions | failedTransactions | notes | createdAt           | updatedAt           |
   | -------- | ------------------ | ----------- | ----------------- | ---------------------- | ------------------ | ----- | ------------------- | ------------------- |
   | 1        | 2023-05-13         | 100000.00   | 1000              | 990                    | 10                 | 无    | 2023-05-13 10:00:00 | 2023-05-13 10:00:00 |

10. **对账规则表（Reconciliation Rule Table）**： 存储对账规则信息，包括规则ID、规则名称、规则描述、应用条件等。

    ### 对账规则表（ReconciliationRule）

    | 字段名           | 数据类型     | 描述                                             | 索引 | 备注 |
    | ---------------- | ------------ | ------------------------------------------------ | ---- | ---- |
    | ruleId           | INT          | 对账规则的唯一标识符。自增主键。                 | PK   |      |
    | ruleName         | VARCHAR(255) | 对账规则的名称。                                 |      |      |
    | ruleType         | VARCHAR(50)  | 对账规则的类型，如自动对账、手动对账等。         |      |      |
    | frequency        | VARCHAR(50)  | 对账频率，如每日、每周、每月等。                 |      |      |
    | timeWindowStart  | TIME         | 对账时间窗口的开始时间。                         |      |      |
    | timeWindowEnd    | TIME         | 对账时间窗口的结束时间。                         |      |      |
    | matchingCriteria | TEXT         | 对账匹配条件，描述了如何匹配交易记录以进行对账。 |      |      |
    | isActive         | BOOLEAN      | 是否激活该对账规则。                             |      |      |
    | createdBy        | VARCHAR(255) | 创建该对账规则的用户。                           |      |      |
    | createdAt        | TIMESTAMP    | 对账规则创建时间。                               |      |      |
    | updatedAt        | TIMESTAMP    | 对账规则最后更新时间。                           |      |      |

    ### 示例数据

    | ruleId | ruleName            | ruleType  | frequency | timeWindowStart | timeWindowEnd | matchingCriteria           | isActive | createdBy | createdAt           | updatedAt           |
    | ------ | ------------------- | --------- | --------- | --------------- | ------------- | -------------------------- | -------- | --------- | ------------------- | ------------------- |
    | 1      | DailyReconciliation | Automatic | Daily     | 00:00:00        | 23:59:59      | Account ID, Transaction ID | true     | admin     | 2023-05-12 10:00:00 | 2023-05-12 10:00:00 |

这些表是账务清算系统的基础，它们之间通过外键关联，形成一个完整的数据模型。在实际设计时，可能还需要根据具体的业务需求和监管要求，添加更多的字段和表，以满足特定的功能和性能要求。此外，为了保证数据的安全性和完整性，还需要设计合理的索引、触发器、存储过程等数据库对象。在设计过程中，还需要考虑到系统的可扩展性和维护性，以便在未来业务扩展时能够方便地进行调整和升级。

# 支付网关

与支付网关相关的数据库表通常包括以下几个关键表：

1. 1.**gTransLog表**： **作用**：记录所有通过支付网关的交易数据，包括交易流水号、交易金额、交易状态等。 **字段示例**： `transId`：交易流水号，唯一标识每笔交易。 `amount`：交易金额。 `status`：交易状态，如待支付、支付成功、支付失败等。 `returnCode`：银行返回的交易结果代码。 `createTime`：交易创建时间。 `updateTime`：交易更新时间。

2. 2.**tAccounts表**： **作用**：记录用户账户的资金信息，包括账户余额、冻结金额等。 **字段示例**： `accountId`：账户ID，唯一标识每个账户。 `balance`：账户余额。 `frozenAmount`：账户冻结金额。

3. 3.**tAccountLog表**： **作用**：记录账户资金变动的流水信息，如充值、消费、提现等。 **字段示例**： `logId`：流水号，唯一标识每笔资金变动。 `accountId`：关联的账户ID。 `changeAmount`：变动金额。 `changeType`：变动类型，如充值、消费等。 `changeTime`：变动时间。

4. 4.**tBankPaymentInfo表**： **作用**：存储银行支付信息，如银行名称、账号等。 **字段示例**： `bankId`：银行ID。 `accountNumber`：银行账号。 `bankName`：银行名称。

5. 5.**tChannelConfig表**： **作用**：配置商户与不同支付渠道的对应关系。 **字段示例**： `channelId`：渠道ID。 `channelName`：渠道名称。 `merchantId`：商户ID。

6. 6.**tFreeze表**： **作用**：记录账户资金的冻结情况，如基金赎回等。 **字段示例**： `freezeId`：冻结ID。 `accountId`：关联的账户ID。 `freezeAmount`：冻结金额。 `freezeReason`：冻结原因。

7. 7.**tPayments表**： **作用**：记录账户付款相关信息。 **字段示例**： `paymentId`：付款ID。 `accountId`：付款账户ID。 `payeeAccountId`：收款账户ID。 `paymentAmount`：付款金额。

8. 8.**tReceivables表**： **作用**：记录收款信息。 **字段示例**： `receivableId`：收款ID。 `accountId`：收款账户ID。 `payerAccountId`：付款账户ID。 `receivableAmount`：收款金额。

这些表是支付网关系统中用于处理和记录交易数据的核心表。在实际的系统设计中，可能还需要根据具体的业务需求和监管要求，添加更多的字段和表，以满足特定的功能和性能要求。在设计过程中，还需要考虑到系统的可扩展性和维护性，以便在未来业务扩展时能够方便地进行调整和升级。[➊](https://blog.csdn.net/WGH100817/article/details/101723590)[❷](https://blog.csdn.net/weixin_34343308/article/details/85796493)[❸](https://blog.csdn.net/burpee/article/details/52430270)[❹](https://open.yesapi.cn/tablelist/yesapi_box_pay_gateway.html)[❺](https://blog.csdn.net/hanghang886/article/details/50161867?locationNum=11&fps=1)[❻](https://blog.csdn.net/yelin042/article/details/56487534)





